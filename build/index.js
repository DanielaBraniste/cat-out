!function(){"use strict";var t="uniform mat4 projection;attribute vec2 vertexPosition;attribute vec2 vertexTexCoord;varying vec2 texCoord;varying float tint;void main(){gl_PointSize=128.0;gl_Position=projection*vec4(vertexPosition,0.0,1.0);texCoord=vertexTexCoord;}",e="precision highp float;uniform sampler2D tex;varying vec2 texCoord;void main(){vec2 texCoord=mix((vec2(16.0)*texCoord)/vec2(64.0,16.0),(vec2(16.0)*(texCoord+vec2(1.0)))/vec2(64.0,16.0),gl_PointCoord);gl_FragColor=texture2D(tex,texCoord);if(gl_FragColor.a<0.1){discard;}}";class s{constructor(s,r){this.gl=s;const i=s.createShader(s.VERTEX_SHADER);s.shaderSource(i,t),s.compileShader(i);const h=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(h,e),s.compileShader(h),this.program=s.createProgram(),s.attachShader(this.program,i),s.attachShader(this.program,h),s.linkProgram(this.program),this.projection=s.getUniformLocation(this.program,"projection"),this.vertexPosition=s.getAttribLocation(this.program,"vertexPosition"),this.vertexTexCoord=s.getAttribLocation(this.program,"vertexTexCoord"),s.useProgram(this.program),this.gl.uniformMatrix4fv(this.projection,!1,r)}use(){this.gl.enableVertexAttribArray(this.vertexPosition),this.gl.enableVertexAttribArray(this.vertexTexCoord),this.gl.vertexAttribPointer(this.vertexPosition,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(this.vertexTexCoord,2,this.gl.FLOAT,!1,16,8)}}class r{constructor(){this.canvasContainer=document.createElement("div"),this.canvasContainer.id="canvas-container",document.body.appendChild(this.canvasContainer),this.canvas=document.createElement("canvas"),this.canvas.width=1024,this.canvas.height=600,this.gl=this.canvas.getContext("webgl"),this.gl.clearColor(.53,.8,.98,1),this.gl.enable(this.gl.BLEND),this.canvasContainer.appendChild(this.canvas),this.textCanvas=document.createElement("canvas"),this.textCanvas.id="text-canvas",this.textCanvas.width=1024,this.textCanvas.height=600,this.textContext=this.textCanvas.getContext("2d"),this.textContext.font="48px Verdana, Arial, Helvetica, sans-serif",this.textContext.textAlign="center",this.textContext.fillStyle="white",this.canvasContainer.appendChild(this.textCanvas),this.projection=new Float32Array([2/1024,0,0,0,0,-2/600,0,0,0,0,-1,0,-1,1,0,1]),this.shader=new s(this.gl,this.projection),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),this.setUpTexture();const t=new Image;t.addEventListener("load",()=>{this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.setUpTexture()}),t.crossOrigin="",t.src="textures/tiles.png"}setUpTexture(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.textContext.clearRect(0,0,1024,600)}draw(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.shader.use(),this.gl.drawArrays(this.gl.POINTS,0,1)}}class i{constructor(){this.spacePressed=!1,this.lastPressed=!1,this.justPressed=!1,addEventListener("keydown",t=>{32==t.keyCode&&(this.spacePressed=!0,t.preventDefault())}),addEventListener("keyup",t=>{32==t.keyCode&&(this.spacePressed=!1,t.preventDefault())})}update(){this.justPressed=!this.lastPressed&&this.spacePressed,this.lastPressed=this.spacePressed}}class h{constructor(t,e,s,r,i){this.renderer=t,this.vertices=new Float32Array([e,s,r,i]),this.vertexBuffer=t.gl.createBuffer(),this.updateBuffer()}updateBuffer(){this.renderer.gl.bindBuffer(this.renderer.gl.ARRAY_BUFFER,this.vertexBuffer),this.renderer.gl.bufferData(this.renderer.gl.ARRAY_BUFFER,this.vertices,this.renderer.gl.STATIC_DRAW)}draw(){this.renderer.draw(this.vertexBuffer)}}class a extends h{constructor(t,e,s,r,i,h){super(t,s,r,i,h),this.input=e,this.timer=0,this.x=s,this.y=r,this.dy=0,this.ay=0}update(t,e){this.timer+=1e3/60,this.timer>=25e3/t&&400===this.y&&(this.timer=0,this.vertices[2]=0===this.vertices[2]?1:0),this.input.justPressed&&400===this.y&&(this.dy=-22,this.ay=1),this.dy+=this.ay,this.y+=this.dy,this.vertices[1]=this.y,this.y>=400&&(this.y=400,this.ay=0,this.dy=0),this.updateBuffer();for(const t of e)if(Math.abs(t.x-this.x)<100&&Math.abs(t.y-this.y)<100)return!0;return!1}}let n=null;class o{constructor(t,e,s,r,i){this.renderer=t,this.vertices=new Float32Array([e,s,r,i]),n||(n=t.gl.createBuffer()),this.updateBuffer(),this.x=e,this.y=s}updateBuffer(){this.renderer.gl.bindBuffer(this.renderer.gl.ARRAY_BUFFER,n),this.renderer.gl.bufferData(this.renderer.gl.ARRAY_BUFFER,this.vertices,this.renderer.gl.STATIC_DRAW)}update(t){this.x-=t/15,this.vertices[0]=this.x}draw(){this.updateBuffer(),this.renderer.draw(n)}}(new class{constructor(){this.renderer=new r,this.input=new i,this.tama=new a(this.renderer,this.input,100,400,0,0),this.cucumbers=[],this.lastTimestamp=0,this.timeAccumulator=0,this.speed=100,this.lastCucumber=0,this.score=0,this.start=!0,this.over=!1,this.started=!1}update(t){requestAnimationFrame(t=>this.update(t));const e=t-this.lastTimestamp;if(this.lastTimestamp=t,!(e>2500)){for(this.timeAccumulator+=e;this.timeAccumulator>=1e3/60;){if(this.input.update(),this.input.justPressed&&!this.started&&(this.started=!0,this.start=!1,this.over=!1,this.speed=100,this.lastCucumber=0,this.score=0,this.cucumbers=[]),this.started){this.tama.update(this.speed,this.cucumbers)&&(this.started=!1,this.over=!0);for(const t of this.cucumbers)t.update(this.speed);if(this.lastCucumber++,this.lastCucumber>80&&Math.random()>.8){let t=1+Math.floor(this.speed/180);for(let e=0;e<t;e++)this.cucumbers.push(new o(this.renderer,1200+128*e,400,2,0));this.lastCucumber=0}this.speed+=.1,this.score+=.1,500===this.speed&&(this.speed=500)}this.timeAccumulator-=1e3/60}this.renderer.clear(),this.tama.draw();for(const t of this.cucumbers)t.draw();this.start?(this.renderer.textContext.textAlign="center",this.renderer.textContext.font="92px Verdana, Arial, Helvetica, sans-serif",this.renderer.textContext.fillText("CAT OUT!",512,100),this.renderer.textContext.font="48px Verdana, Arial, Helvetica, sans-serif",this.renderer.textContext.fillText("PRESS SPACE TO BEGIN",512,500)):this.over?(this.renderer.textContext.textAlign="center",this.renderer.textContext.font="92px Verdana, Arial, Helvetica, sans-serif",this.renderer.textContext.fillText("GAME OVER!",512,100),this.renderer.textContext.font="48px Verdana, Arial, Helvetica, sans-serif",this.renderer.textContext.fillText(`FINAL SCORE: ${Math.round(this.score)}`,512,200),this.renderer.textContext.fillText("PRESS SPACE TO TRY AGAIN",512,500)):(this.renderer.textContext.textAlign="left",this.renderer.textContext.font="48px Verdana, Arial, Helvetica, sans-serif",this.renderer.textContext.fillText(`SCORE: ${Math.round(this.score)}`,20,50))}}run(){requestAnimationFrame(t=>this.update(t))}}).run()}();
